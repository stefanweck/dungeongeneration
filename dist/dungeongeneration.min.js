!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("../geometry/boundary.js"),d=function(a,b){this.game=a,this.position=b,this.viewportWidth=a.width,this.viewportHeight=a.height,this.minimumDistanceX=0,this.minimumDistanceY=0,this.followObject=null,this.viewportBoundary=new c(this.position.x*a.settings.tileSize*this.game.settings.zoom,this.position.y*a.settings.tileSize*this.game.settings.zoom,this.viewportWidth,this.viewportHeight),this.mapBoundary=new c(0,0,a.settings.tilesX*a.settings.tileSize*this.game.settings.zoom,a.settings.tilesY*a.settings.tileSize*this.game.settings.zoom)};d.prototype={follow:function(a,b,c){this.followObject=a.components.position,this.minimumDistanceX=b,this.minimumDistanceY=c},update:function(){if(null!==this.followObject){var a=this.game.map.settings.tileSize*this.game.settings.zoom,b=this.followObject.position.x*a+a/2,c=this.followObject.position.y*a+a/2;b-this.position.x+this.minimumDistanceX>this.viewportWidth?this.position.x=Math.floor(b-(this.viewportWidth-this.minimumDistanceX)):b-this.minimumDistanceX<this.position.x&&(this.position.x=Math.floor(b-this.minimumDistanceX)),c-this.position.y+this.minimumDistanceY>this.viewportHeight?this.position.y=Math.floor(c-(this.viewportHeight-this.minimumDistanceY)):c-this.minimumDistanceY<this.position.y&&(this.position.y=Math.floor(c-this.minimumDistanceY))}this.viewportBoundary.set(this.position.x,this.position.y),this.game.settings.cameraBounds&&!this.viewportBoundary.isWithin(this.mapBoundary)&&(this.viewportBoundary.left<this.mapBoundary.left&&(this.position.x=this.mapBoundary.left),this.viewportBoundary.top<this.mapBoundary.top&&(this.position.y=this.mapBoundary.top),this.viewportBoundary.right>this.mapBoundary.right&&(this.position.x=this.mapBoundary.right-this.viewportWidth),this.viewportBoundary.bottom>this.mapBoundary.bottom&&(this.position.y=this.mapBoundary.bottom-this.viewportHeight))}},b.exports=d},{"../geometry/boundary.js":30}],2:[function(a,b){"use strict";var c=a("./utils.js"),d=a("../ui/ui.js"),e=(a("./camera.js"),a("./world.js")),f=a("../tilemap/map.js"),g=a("../factories/playerfactory.js"),h=a("../geometry/vector2.js"),i=a("../gameobjects/group.js"),j=a("../gameobjects/systems/combat.js"),k=a("../gameobjects/systems/lightmap.js"),l=a("../gameobjects/systems/movement.js"),m=a("../gameobjects/systems/open.js"),n=a("../gameobjects/systems/pathfinding.js"),o=a("../tilemap/mapfactory.js"),p=a("../tilemap/mapdecorator.js"),q=a("../time/scheduler.js"),r=a("../input/keyboard.js"),s=a("../gameobjects/statuseffects/fire.js"),t=function(a){this.isInitialized=!1,this.isActive=!1,this.width=!1,this.height=!1,this.map=null,this.mapFactory=null,this.mapDecorator=null,this.keyboard=null,this.scheduler=null,this.staticSystems={},this.dynamicSystems=[],this.player=null,this.world=null,this.UI=null,this.stage=null,this.renderer=null,this.settings={tilesX:60,tilesY:40,zoom:3},this.settings=c.extend(this.settings,a),this.load()};t.prototype={load:function(){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST;var a=["assets/tilesets/dungeon.json","assets/sprites/entities.json","assets/tilesets/decoration.json","assets/tilesets/ui.json"],b=new PIXI.AssetLoader(a);b.onComplete=this.initialize.bind(this),b.load()},initialize:function(){if(!this.isInitialized){this.width=window.innerWidth,this.height=window.innerHeight,this.stage=new PIXI.Stage(0),this.renderer=PIXI.autoDetectRenderer(this.width,this.height),document.body.appendChild(this.renderer.view),this.world=new e(this),this.UI=new d(this),this.keyboard=new r,this.scheduler=new q,this.initializeMap();var a=new h(this.map.entrance.x,this.map.entrance.y),b={left:65,right:68,up:87,down:83};this.player=g.newPlayerWarrior(this,a,b),this.initializePlayer(),this.staticSystems.movementSystem=new l(this),this.staticSystems.pathfindingSystem=new n(this),this.staticSystems.combatSystem=new j(this),this.staticSystems.openSystem=new m(this),this.dynamicSystems.push(new k(this)),this.update(),this.isInitialized=!0,this.isActive=!0}},initializeMap:function(){this.map=new f(this),this.mapFactory=new o(this),this.mapDecorator=new p(this),this.map.entities=new i(this),this.mapFactory.generateRooms(),this.mapDecorator.decorateMap(),this.world.addChild(this.map.entities)},initializePlayer:function(){var a=new h(this.map.entrance.x,this.map.entrance.y),b=this.player.getComponent("position");b.position=a;var c=this.player.getComponent("health");c.health=c.maxHealth,this.map.entities.addEntity(this.player);var d=this.map.tiles[a.x][a.y];d.addEntity(this.player),this.player.statusEffects.push(new s),this.scheduler.add(this.player,!0),this.world.camera.follow(this.player,this.width/2,this.height/2)},update:function(){for(this.UI.stats.begin(),this.isInitialized&&!this.isActive&&this.restart(),requestAnimationFrame(this.update.bind(this));!this.scheduler.lockCount;)this.scheduler.tick();for(var a=0;a<this.dynamicSystems.length;a++)this.dynamicSystems[a].update();this.world.camera.update(),this.world.position=new PIXI.Point(-this.world.camera.position.x,-this.world.camera.position.y),this.renderer.render(this.stage),this.UI.stats.end()},restart:function(){this.scheduler.clear(),this.initializeMap(),this.initializePlayer(),this.staticSystems.pathfindingSystem.game=this,this.staticSystems.pathfindingSystem.initialize(),this.textLog.clear(),this.isActive=!0}},b.exports=t},{"../factories/playerfactory.js":7,"../gameobjects/group.js":22,"../gameobjects/statuseffects/fire.js":23,"../gameobjects/systems/combat.js":25,"../gameobjects/systems/lightmap.js":26,"../gameobjects/systems/movement.js":27,"../gameobjects/systems/open.js":28,"../gameobjects/systems/pathfinding.js":29,"../geometry/vector2.js":31,"../input/keyboard.js":35,"../tilemap/map.js":38,"../tilemap/mapdecorator.js":39,"../tilemap/mapfactory.js":40,"../time/scheduler.js":44,"../ui/ui.js":49,"./camera.js":1,"./utils.js":3,"./world.js":4}],3:[function(a,b){"use strict";var c=a("../libraries/mersennetwister.js"),d=Math.floor(500*Math.random()+1);console.log("Map Seed: "+d);var e={mersenneTwister:new c(d),randomNumber:function(a,b){return Math.floor(this.mersenneTwister.random()*(b-a+1)+a)},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};b.exports=e},{"../libraries/mersennetwister.js":37}],4:[function(a,b){"use strict";var c=a("./camera.js"),d=a("../geometry/vector2.js"),e=function(a){PIXI.DisplayObjectContainer.call(this),this.game=a,this.camera=null,this.initialize()};e.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),e.prototype.constructor=e,e.prototype.initialize=function(){this.camera=new c(this.game,new d(0,0)),this.scale=new PIXI.Point(this.game.settings.zoom,this.game.settings.zoom),this.game.stage.addChild(this)},b.exports=e},{"../geometry/vector2.js":31,"./camera.js":1}],5:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/position.js"),e=a("../core/utils.js"),f={newGrass:function(a,b){var f=new c(a,"Grass","grass_"+e.randomNumber(1,4)+".png");return f.addComponent(new d(b)),f}};b.exports=f},{"../core/utils.js":3,"../gameobjects/components/position.js":18,"../gameobjects/entity.js":21}],6:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/behaviours/moveBehaviours.js"),e=a("../gameobjects/components/position.js"),f=(a("../gameobjects/components/canopen.js"),a("../gameobjects/components/collide.js")),g=a("../gameobjects/components/health.js"),h=a("../gameobjects/components/canfight.js"),i=a("../gameobjects/components/weapon.js"),j=a("../gameobjects/components/movement.js"),k=a("../gameobjects/components/tooltip.js"),l={newSpider:function(a,b){var l=new c(a,"Quick Spider","spider_small_right.png",2e3);return l.addComponent(new g(20)),l.addComponent(new e(b)),l.addComponent(new f(!0)),l.addComponent(new j(a,l,d.walkBehaviour())),l.addComponent(new i(4)),l.addComponent(new h(a)),l.addComponent(new k(l.name,"Arachnid Enemy","The quick spider is twice as fast as you and will definitely attack you. It's just programmed to do so.")),l},newSkeleton:function(a,b){var l=new c(a,"Skeleton","skeleton_right.png",1e3);return l.addComponent(new g(50)),l.addComponent(new e(b)),l.addComponent(new f(!0)),l.addComponent(new j(a,l,d.walkBehaviour())),l.addComponent(new i(10)),l.addComponent(new h(a)),l.addComponent(new k(l.name,"Undead Enemy","The skeleton is a very dangerous but unstable enemy. If you stab just right his bones will collapse.")),l}};b.exports=l},{"../gameobjects/behaviours/moveBehaviours.js":9,"../gameobjects/components/canfight.js":10,"../gameobjects/components/canopen.js":11,"../gameobjects/components/collide.js":12,"../gameobjects/components/health.js":13,"../gameobjects/components/movement.js":17,"../gameobjects/components/position.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/components/weapon.js":20,"../gameobjects/entity.js":21}],7:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/health.js"),e=a("../gameobjects/components/lightsource.js"),f=a("../gameobjects/components/collide.js"),g=a("../gameobjects/components/weapon.js"),h=a("../gameobjects/components/keyboardcontrol.js"),i=a("../gameobjects/components/canfight.js"),j=a("../gameobjects/components/tooltip.js"),k=a("../gameobjects/components/inventory.js"),l=a("../gameobjects/components/position.js"),m={newPlayerWarrior:function(a,b,m){var n=new c(a,"You","warrior_right.png",1e3);return n.addComponent(new d(100)),n.addComponent(new l(b)),n.addComponent(new h(a,n,m)),n.addComponent(new e(!0,6)),n.addComponent(new f(!0)),n.addComponent(new k),n.addComponent(new g(7)),n.addComponent(new i(a)),n.addComponent(new j("Player","","")),n}};b.exports=m},{"../gameobjects/components/canfight.js":10,"../gameobjects/components/collide.js":12,"../gameobjects/components/health.js":13,"../gameobjects/components/inventory.js":14,"../gameobjects/components/keyboardcontrol.js":15,"../gameobjects/components/lightsource.js":16,"../gameobjects/components/position.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/components/weapon.js":20,"../gameobjects/entity.js":21}],8:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=a("../gameobjects/components/position.js"),e=a("../gameobjects/components/canopen.js"),f=a("../gameobjects/components/collide.js"),g=a("../gameobjects/components/tooltip.js"),h={newEntrance:function(a,b){var e=new c(a,"Entrance","stairs_down.png");return e.addComponent(new d(b)),e},newExit:function(a,b){var e=new c(a,"Exit","stairs_up.png");return e.addComponent(new d(b)),e},newDoor:function(a,b){var h=new c(a,"Wooden Door","door_horizontal_closed.png");return h.addComponent(new d(b)),h.addComponent(new e(a,h)),h.addComponent(new f(!0)),h.addComponent(new g(h.name,"Closed","")),h}};b.exports=h},{"../gameobjects/components/canopen.js":11,"../gameobjects/components/collide.js":12,"../gameobjects/components/position.js":18,"../gameobjects/components/tooltip.js":19,"../gameobjects/entity.js":21}],9:[function(a,b){"use strict";var c={walkBehaviour:function(){return function(a,b){var c=[2];a.staticSystems.pathfindingSystem.handleSingleEntity(b,c)}},flyBehaviour:function(){return function(a,b){var c=[2];a.staticSystems.pathfindingSystem.handleSingleEntity(b,c)}}};b.exports=c},{}],10:[function(a,b){"use strict";var c=a("../../input/event.js"),d=function(a){this.name="canFight",this.game=a,this.events=new c,this.initialize()};d.prototype={initialize:function(){this.events.on("bumpInto",this.bumpInto,this)},bumpInto:function(a,b){this.game.staticSystems.combatSystem.handleSingleEntity(a,b)}},b.exports=d},{"../../input/event.js":33}],11:[function(a,b){"use strict";var c=a("../../input/event.js"),d=function(a,b){this.name="canOpen",this.game=a,this.entity=b,this.events=new c,this.state="closed",this.initialize()};d.prototype={initialize:function(){this.events.on("bumpInto",this.bumpInto,this)},bumpInto:function(){this.game.staticSystems.openSystem.handleSingleEntity(this.entity)}},b.exports=d},{"../../input/event.js":33}],12:[function(a,b){"use strict";var c=function(a){this.name="collide",this.collide=a};b.exports=c},{}],13:[function(a,b){"use strict";var c=function(a){this.name="health",this.minHealth=0,this.health=this.maxHealth=a};c.prototype={percentage:function(){return this.health/this.maxHealth},isDamaged:function(){return this.health<this.maxHealth},isDead:function(){return this.health<=this.minHealth},takeDamage:function(a){this.health-=a,this.health<this.minHealth&&(this.health=this.minHealth)}},b.exports=c},{}],14:[function(a,b){"use strict";var c=function(){this.name="inventory",this.maxSlots=0,this.slots=[]};c.prototype={add:function(a){this.slots.push(a)},clear:function(){this.slots=[]}},b.exports=c},{}],15:[function(a,b){"use strict";var c=a("../../geometry/vector2.js"),d=function(a,b,c){this.name="keyboardControl",this.entity=b,this.game=a,this.controls=c,this.keyboard=a.keyboard,this.scheduler=a.scheduler,this.initialize()};d.prototype={initialize:function(){for(var a in this.controls)if(this.controls.hasOwnProperty(a))switch(a){case"left":var b=this.keyboard.getKey(this.controls[a]);b.onDown.on(this.controls[a],this.newPosition.bind(this,"left"),this);break;case"right":var c=this.keyboard.getKey(this.controls[a]);c.onDown.on(this.controls[a],this.newPosition.bind(this,"right"),this);break;case"up":var d=this.keyboard.getKey(this.controls[a]);d.onDown.on(this.controls[a],this.newPosition.bind(this,"up"),this);break;case"down":var e=this.keyboard.getKey(this.controls[a]);e.onDown.on(this.controls[a],this.newPosition.bind(this,"down"),this)}},newPosition:function(a){var b;switch(a){case"left":b=new c(-1,0);break;case"up":b=new c(0,-1);break;case"right":b=new c(1,0);break;case"down":b=new c(0,1)}var d=this.entity.getComponent("position"),e=d.position.combine(b);this.game.staticSystems.movementSystem.handleSingleEntity(this.entity,e),this.scheduler.unlock()}},b.exports=d},{"../../geometry/vector2.js":31}],16:[function(a,b){"use strict";var c=function(a,b){this.name="lightSource",this.gradient=a,this.radius=b};b.exports=c},{}],17:[function(a,b){"use strict";var c=function(a,b,c){this.name="movement",this.game=a,this.entity=b,this.move=c};c.prototype={execute:function(){this.move(this.game,this.entity)}},b.exports=c},{}],18:[function(a,b){"use strict";var c=function(a){this.name="position",this.position=a};b.exports=c},{}],19:[function(a,b){"use strict";var c=function(a,b,c){this.name="tooltip",this.title=a,this.type=b,this.description=c};b.exports=c},{}],20:[function(a,b){"use strict";var c=function(a){this.name="weapon",this.damage=a};b.exports=c},{}],21:[function(a,b){"use strict";var c=function(a,b,c,d){this.game=a,this.name=b,this.speed=d||1e3,this.textureName=c,this.sprite=PIXI.Sprite.fromFrame(c),this.components={},this.statusEffects=[]};c.prototype={act:function(){if(this.statusEffects.length>0)for(var a=0;a<this.statusEffects.length;a++)this.statusEffects[a].update(this);if(this.hasComponent("keyboardControl"))this.game.scheduler.lock();else{var b=this.getComponent("movement");b.execute()}},getSpeed:function(){return this.speed},hasComponent:function(a){return void 0!==this.components[a]},getComponent:function(a){return this.components[a]},addComponent:function(a){this.components[a.name]=a},removeComponent:function(a){this.components[a.name]=void 0},getStatusEffects:function(){return this.statusEffects},addStatusEffect:function(a){for(var b=-1,c=0;c<this.statusEffects.length;c++)if(this.statusEffects[c].name===a.name){b=c;break}-1!==b?a.stackable===!0&&(a.addStack===!0?this.statusEffects[b].turnsLeft+=a.turnsLeft:this.statusEffects[b].turnsLeft=a.turnsLeft):this.statusEffects.push(a)},removeStatusEffect:function(a){var b=this.statusEffects.indexOf(a);return-1===b?!1:(this.statusEffects.splice(b,1),!0)}},b.exports=c},{}],22:[function(a,b){"use strict";var c=a("../gameobjects/entity.js"),d=function(a){PIXI.DisplayObjectContainer.call(this),this.game=a,this.entities=[]};d.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),d.prototype.constructor=d,d.prototype.addEntity=function(a){if(!(!a instanceof c)){if(this.addChild(a.sprite),a.hasComponent("position")){var b=a.getComponent("position"),d={x:16*b.position.x,y:16*b.position.y};a.sprite.position=new PIXI.Point(d.x,d.y)}this.entities.push(a)}},d.prototype.removeEntity=function(a){var b=this.entities.indexOf(a);-1!==b&&(this.removeChild(a.sprite),this.entities.splice(b,1))},d.prototype.getEntities=function(){for(var a=[],b=0;b<this.entities.length;b++){for(var c=[],d=0;d<arguments.length;d++)this.entities[b].components[arguments[d]]&&c.push(1);c.length===arguments.length&&a.push(this.entities[b])}return a},b.exports=d},{"../gameobjects/entity.js":21}],23:[function(a,b){"use strict";var c=a("./statuseffect.js"),d=function(){c.call(this),this.name="Fire",this.turnsLeft=5,this.stackable=!1,this.addStack=!1};d.prototype=Object.create(c.prototype,{update:{value:function(a){var b=a.getComponent("health");b.takeDamage(5),this.baseUpdate(a)}}}),b.exports=d},{"./statuseffect.js":24}],24:[function(a,b){"use strict";var c=function(){this.name="Base Effect",this.turnsLeft=0,this.stackable=!1,this.addStack=!1};c.prototype={update:function(a){this.baseUpdate(a)},baseUpdate:function(a){this.turnsLeft--,this.turnsLeft<=0&&a.removeStatusEffect(this)}},b.exports=c},{}],25:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a,b){var c=a.getComponent("weapon");if(b.hasComponent("health")){var d=b.getComponent("health");d.takeDamage(c.damage);var e=a.name+" hit "+b.name+" for "+c.damage+" damage";d.isDead()&&(this.removeEntity(b),e+=" and killed him with that attack!"),this.game.UI.textLog.addMessage(e)}},removeEntity:function(a){a.hasComponent("keyboardControl")&&(this.game.scheduler.lock(),this.game.isActive=!1),this.game.map.entities.removeEntity(a),this.game.scheduler.remove(a);var b=a.getComponent("position"),c=this.game.map.tiles[b.position.x][b.position.y];c.removeEntity(a)}},b.exports=c},{}],26:[function(a,b){"use strict";var c=a("../../geometry/vector2.js"),d=function(a){PIXI.SpriteBatch.call(this),this.game=a,this.mapSize={x:a.map.settings.tilesX,y:a.map.settings.tilesY},this.tiles=[],this.pixitiles=[],this.mult=[[1,0,0,-1,-1,0,0,1],[0,1,-1,0,0,-1,1,0],[0,1,1,0,0,-1,-1,0],[1,0,0,1,-1,0,0,-1]],this.tilesLit=!1,this.initialize()};d.prototype=Object.create(PIXI.SpriteBatch.prototype),d.prototype.constructor=d,d.prototype.initialize=function(){for(var a=0;a<this.game.map.settings.tilesX;a++){this.pixitiles[a]=[];for(var b=0;b<this.game.map.settings.tilesY;b++)this.pixitiles[a][b]=PIXI.Sprite.fromFrame("void.png"),this.pixitiles[a][b].position.x=a*this.game.map.settings.tileSize,this.pixitiles[a][b].position.y=b*this.game.map.settings.tileSize,this.addChild(this.pixitiles[a][b])}this.game.world.addChild(this)},d.prototype.update=function(){if(this.game.isActive){for(var a=this.game.map.entities.getEntities("lightSource","position"),b=0;b<a.length;b++)this.handleSingleEntity(a[b]);this.tilesLit=!0}else this.tilesLit&&(this.clear(),this.tilesLit=!1)},d.prototype.handleSingleEntity=function(a){for(var b=a.getComponent("lightSource"),c=a.getComponent("position"),d=this.clear().concat(this.calculate(b,c.position)),e=0;e<d.length;e++)this.game.map.tiles[d[e].x][d[e].y].explored?1-d[e].lightLevel<.7?(this.pixitiles[d[e].x][d[e].y].alpha=1-d[e].lightLevel,this.game.map.tiles[d[e].x][d[e].y].lightLevel=d[e].lightLevel):(this.pixitiles[d[e].x][d[e].y].alpha=.7,this.game.map.tiles[d[e].x][d[e].y].lightLevel=.7):(this.pixitiles[d[e].x][d[e].y].alpha=1-d[e].lightLevel,this.game.map.tiles[d[e].x][d[e].y].explored=!0)},d.prototype.doesTileBlock=function(a,b){return this.game.map.tiles[a][b].blockLight},d.prototype.calculateOctant=function(a,b,d,e,f,g,h,i,j,k){this.tiles.push({x:a.x,y:a.y,lightLevel:0});var l=0;if(!(e>d))for(var m=f.radius*f.radius,n=b;n<f.radius+1;n++){for(var o=-n-1,p=-n,q=!1;0>=o;){o+=1;var r=a.x+o*g+p*h,s=a.y+o*i+p*j;if(r<this.mapSize.x&&r>=0&&s<this.mapSize.y&&s>=0){var t=(o-.5)/(p+.5),u=(o+.5)/(p-.5);if(u>d)continue;if(e>t)break;if(m>o*o+p*p){var v=new c(r,s),w=a,x=(v.x-w.x)*(v.x-w.x)+(v.y-w.y)*(v.y-w.y);this.tiles.push({x:r,y:s,lightLevel:f.gradient===!1?1:1-x/(f.radius*f.radius)})}if(q){if(this.doesTileBlock(r,s)){l=u;continue}q=!1,d=l}else this.doesTileBlock(r,s)&&n<f.radius&&(q=!0,this.calculateOctant(a,n+1,d,t,f,g,h,i,j,k+1),l=u)}}if(q)break}},d.prototype.clear=function(){for(var a=this.tiles.length;a--;)this.tiles[a].lightLevel=0;var b=this.tiles;return this.tiles=[],b},d.prototype.calculate=function(a,b){for(var c=0;8>c;c++)this.calculateOctant(b,1,1,0,a,this.mult[0][c],this.mult[1][c],this.mult[2][c],this.mult[3][c],0);return this.tiles.push({x:b.x,y:b.y,lightLevel:1}),this.tiles},b.exports=d},{"../../geometry/vector2.js":31}],27:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a,b){if(this.changeDirection(a,b),this.canMove(a,b)){var c=a.getComponent("position"),d=this.game.map.tiles[c.position.x][c.position.y],e=this.game.map.tiles[b.x][b.y];d.removeEntity(a),e.addEntity(a),a.sprite.position=new PIXI.Point(b.x*this.game.map.settings.tileSize,b.y*this.game.map.settings.tileSize),c.position=b}},changeDirection:function(a,b){var c=a.getComponent("position");b.x>c.position.x?a.textureName=a.textureName.replace("left","right"):b.x<c.position.x&&(a.textureName=a.textureName.replace("right","left"));var d=PIXI.Texture.fromFrame(a.textureName);a.sprite.setTexture(d)},canMove:function(a,b){var c=this.game.map.tiles[b.x][b.y];if(2!==c.type)return!1;if(0!==c.entities.length){for(var d=!0,e=0;e<c.entities.length;e++){if(c.entities[e].hasComponent("collide")){var f=c.entities[e].getComponent("collide");f.collide===!0&&(d=!1)}for(var g in c.entities[e].components){if("undefined"==typeof c.entities[e])break;c.entities[e].components.hasOwnProperty(g)&&"undefined"!=typeof c.entities[e].components[g].events&&c.entities[e].components[g].events.trigger("bumpInto",a,c.entities[e])}}return d}return!0}},b.exports=c},{}],28:[function(a,b){"use strict";var c=function(a){this.game=a};c.prototype={handleSingleEntity:function(a){{var b=a.getComponent("canOpen"),c=a.getComponent("position"),d=a.getComponent("collide");a.getComponent("tooltip")}if("open"!==b.state){b.state="open",a.textureName=a.textureName.replace("closed","open");var e=PIXI.Texture.fromFrame(a.textureName);a.sprite.setTexture(e),d.collide=!1,this.game.map.tiles[c.position.x][c.position.y].blockLight=!1}}},b.exports=c},{}],29:[function(a,b){"use strict";var c=a("../../libraries/easystar.js"),d=a("../../geometry/vector2.js"),e=function(a){this.game=a,this.easystar=null,this.initialize()};e.prototype={initialize:function(){this.easystar=new c.js,this.easystar.setGrid(this.game.map.typeList()),this.easystar.disableDiagonals()},handleSingleEntity:function(a,b){this.easystar.setAcceptableTiles(b);var c=a.getComponent("position"),d="attack";switch(d){case"attack":var e=this.game.player,f=e.getComponent("position"),g=this.game.map.getTileAt(c.position);g.lightLevel>.7&&(this.easystar.findPath(c.position.x,c.position.y,f.position.x,f.position.y,this.findPathHandler.bind(this,a)),this.easystar.calculate())}},findPathHandler:function(a,b){if(null===b||0===b.length)console.log("no path found");else{var c=new d(b[1].x,b[1].y);this.game.staticSystems.movementSystem.handleSingleEntity(a,c)}}},b.exports=e},{"../../geometry/vector2.js":31,"../../libraries/easystar.js":36}],30:[function(a,b){"use strict";var c=function(a,b,c,d){this.left=a||0,this.top=b||0,this.width=c||0,this.height=d||0,this.right=this.left+this.width,this.bottom=this.top+this.height};c.prototype={set:function(a,b,c,d){this.left=a,this.top=b,this.width=c||this.width,this.height=d||this.height,this.right=this.left+this.width,this.bottom=this.top+this.height},isWithin:function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom},isOverlapping:function(a){return this.left<a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom}},b.exports=c},{}],31:[function(a,b){"use strict";var c=function(a,b){this.x=a,this.y=b};c.prototype={combine:function(a){return new c(this.x+a.x,this.y+a.y)},add:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},distance:function(a){var b=a.x-this.x,c=a.y-this.y;return Math.abs(Math.sqrt(b*b+c*c))},manhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},clone:function(){return new c(this.x,this.y)},toString:function(){return"("+this.x+", "+this.y+")"}},b.exports=c},{}],32:[function(a,b){"use strict";var c=a("./core/game.js"),d=function(){{var a={};new c(a)}};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.addEventListener("load",d),b.exports=d},{"./core/game.js":2}],33:[function(a,b){"use strict";var c=function(){this.events={}};c.prototype={on:function(a,b,c){this.events.hasOwnProperty(a)||(this.events[a]=[]),this.events[a].push([b,c])},trigger:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.events[a];if(void 0!==c)for(var d=0;d<c.length;d++){var e,f=c[d][0];e=void 0===c[d][1]?this:c[d][1],f.apply(e,b)}}},b.exports=c},{}],34:[function(a,b){"use strict";var c=a("./event.js"),d=function(a){this.keyCode=a,this.isDown=!1,this.isUp=!1,this.lastDown=0,this.lastUp=0,this.delay=50,this.onDown=new c,this.onUp=new c};d.prototype={processKeyDown:function(a){this.isDown?a.timeStamp>this.lastDown+this.delay&&(this.onDown.trigger(this.keyCode),this.lastDown=a.timeStamp):(this.isDown=!0,this.isUp=!1,this.lastDown=a.timeStamp,this.onDown.trigger(this.keyCode))},processKeyUp:function(a){this.isDown=!1,this.isUp=!0,this.lastUp=a.timeStamp,this.onUp.trigger(this.keyCode)}},b.exports=d},{"./event.js":33}],35:[function(a,b){"use strict";var c=a("./key.js"),d=function(){this.keys={},this.initialize()};d.prototype={initialize:function(){this._onKeyDown=function(a){return this.processKeyDown(a)},this._onKeyUp=function(a){return this.processKeyUp(a)},window.addEventListener("keydown",this._onKeyDown.bind(this),!1),window.addEventListener("keyup",this._onKeyUp.bind(this),!1)},getKey:function(a){return void 0===this.keys[a]&&(this.keys[a]=new c(a)),this.keys[a]},processKeyDown:function(a){void 0!==this.keys[a.keyCode]&&(a.preventDefault(),this.keys[a.keyCode].processKeyDown(a))},processKeyUp:function(a){void 0!==this.keys[a.keyCode]&&this.keys[a.keyCode].processKeyUp(a)}},b.exports=d},{"./key.js":34}],36:[function(a,b){var c=c||{};c.Node=function(a,b,c,d,e){this.parent=a,this.x=b,this.y=c,this.costSoFar=d,this.simpleDistanceToTarget=e,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},c.Node.OPEN_LIST=0,c.Node.CLOSED_LIST=1,c.PriorityQueue=function(a,b){this.length=0;var d=[],e=!1;if(b==c.PriorityQueue.MAX_HEAP)e=!0;else{if(b!=c.PriorityQueue.MIN_HEAP)throw b+" not supported.";e=!1}this.insert=function(b){if(!b.hasOwnProperty(a))throw"Cannot insert "+b+" because it does not have a property by the name of "+a+".";d.push(b),this.length++,f(this.length-1)},this.getHighestPriorityElement=function(){return d[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var a=d[0];return d=[],this.length=0,a}var b=d[0],c=d.pop();return this.length--,d[0]=c,g(0),b};var f=function(a){if(0!==a){var b=j(a);i(a,b)&&(h(a,b),f(b))}},g=function(a){if(left=k(a),right=l(a),i(left,a))h(a,left),g(left);else if(i(right,a))h(a,right),g(right);else{if(0==a)return;g(0)}},h=function(a,b){var c=d[a];d[a]=d[b],d[b]=c},i=function(b,c){return void 0===d[c]||void 0===d[b]?!1:("function"==typeof d[b][a]?(selfValue=d[b][a](),targetValue=d[c][a]()):(selfValue=d[b][a],targetValue=d[c][a]),e?selfValue>targetValue?!0:!1:targetValue>selfValue?!0:!1)},j=function(a){return Math.floor(a/2)-1},k=function(a){return 2*a+1},l=function(a){return 2*a+2}},c.PriorityQueue.MAX_HEAP=0,c.PriorityQueue.MIN_HEAP=1,c.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},c.js=function(){var a,b,d,e=10,f=14,g={},h={},i=[],j=Number.MAX_VALUE,k=!1;this.setAcceptableTiles=function(a){a instanceof Array?d=a:!isNaN(parseFloat(a))&&isFinite(a)&&(d=[a])},this.enableDiagonals=function(){k=!0},this.disableDiagonals=function(){k=!1},this.setGrid=function(b){a=b;for(var c=0;c<a.length;c++)for(var d=0;d<a[0].length;d++)h[a[c][d]]||(h[a[c][d]]=1)},this.setTileCost=function(a,b){h[a]=b},this.setIterationsPerCalculation=function(a){j=a},this.avoidAdditionalPoint=function(a,b){g[a+"_"+b]=1},this.stopAvoidingAdditionalPoint=function(a,b){delete g[a+"_"+b]},this.stopAvoidingAllAdditionalPoints=function(){g={}},this.findPath=function(b,f,g,h,j){if(void 0===d)throw"You can't set a path without first calling setAcceptableTiles() on EasyStar.";if(void 0===a)throw"You can't set a path without first calling setGrid() on EasyStar.";if(0>b||0>f||0>g||0>g||b>a[0].length-1||f>a.length-1||g>a[0].length-1||h>a.length-1)throw"Your start or end point is outside the scope of your grid.";b===g&&f===h&&j([]);for(var k=a[h][g],l=!1,n=0;n<d.length;n++)if(k===d[n]){l=!0;break}if(l===!1)return void j(null);var o=new c.instance;o.openList=new c.PriorityQueue("bestGuessDistance",c.PriorityQueue.MIN_HEAP),o.isDoneCalculating=!1,o.nodeHash={},o.startX=b,o.startY=f,o.endX=g,o.endY=h,o.callback=j,o.openList.insert(m(o,o.startX,o.startY,null,e)),i.push(o)},this.calculate=function(){if(0!==i.length&&void 0!==a&&void 0!==d)for(b=0;j>b;b++){if(0===i.length)return;if(0!==i[0].openList.length){var g=i[0].openList.shiftHighestPriorityElement();if(g.list=c.Node.CLOSED_LIST,g.y>0&&(l(i[0],g,0,-1,e*h[a[g.y-1][g.x]]),i[0].isDoneCalculating===!0))i.shift();else if(g.x<a[0].length-1&&(l(i[0],g,1,0,e*h[a[g.y][g.x+1]]),i[0].isDoneCalculating===!0))i.shift();else if(g.y<a.length-1&&(l(i[0],g,0,1,e*h[a[g.y+1][g.x]]),i[0].isDoneCalculating===!0))i.shift();else if(g.x>0&&(l(i[0],g,-1,0,e*h[a[g.y][g.x-1]]),i[0].isDoneCalculating===!0))i.shift();else if(k){if(g.x>0&&g.y>0&&(l(i[0],g,-1,-1,f*h[a[g.y-1][g.x-1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x<a[0].length-1&&g.y<a.length-1&&(l(i[0],g,1,1,f*h[a[g.y+1][g.x+1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x<a[0].length-1&&g.y>0&&(l(i[0],g,1,-1,f*h[a[g.y-1][g.x+1]]),i[0].isDoneCalculating===!0)){i.shift();continue}if(g.x>0&&g.y<a.length-1&&(l(i[0],g,-1,1,f*h[a[g.y+1][g.x-1]]),i[0].isDoneCalculating===!0)){i.shift();continue}}}else i[0].callback(null),i.shift()}};var l=function(b,e,f,h,i){var j=e.x+f,k=e.y+h;if(b.endX===j&&b.endY===k){b.isDoneCalculating=!0;var l=[],n=0;l[n]={x:j,y:k},n++,l[n]={x:e.x,y:e.y},n++;for(var o=e.parent;null!=o;)l[n]={x:o.x,y:o.y},n++,o=o.parent;l.reverse(),b.callback(l)}if(void 0===g[j+"_"+k])for(var p=0;p<d.length;p++)if(a[k][j]===d[p]){var q=m(b,j,k,e,i);void 0===q.list?(q.list=c.Node.OPEN_LIST,b.openList.insert(q)):q.list===c.Node.OPEN_LIST&&e.costSoFar+i<q.costSoFar&&(q.costSoFar=e.costSoFar+i,q.parent=e);break}},m=function(a,b,d,e,f){if(void 0!==a.nodeHash[b+"_"+d])return a.nodeHash[b+"_"+d];var g=n(b,d,a.endX,a.endY);if(null!==e)var h=e.costSoFar+f;else h=g;var i=new c.Node(e,b,d,h,g);return a.nodeHash[b+"_"+d]=i,i},n=function(a,b,c,d){return Math.floor(Math.abs(b-a)+Math.abs(d-c))}},"function"==typeof define&&define.amd&&define("easystar",[],function(){return c}),b.exports=c
},{}],37:[function(a,b){"use strict";var c=function(a){void 0==a&&(a=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(a)};c.prototype.init_genrand=function(a){for(this.mt[0]=a>>>0,this.mti=1;this.mti<this.N;this.mti++){var a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&a)>>>16)<<16)+1812433253*(65535&a)+this.mti,this.mt[this.mti]>>>=0}},c.prototype.init_by_array=function(a,b){var c,d,e;for(this.init_genrand(19650218),c=1,d=0,e=this.N>b?this.N:b;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((4294901760&f)>>>16)<<16)+1664525*(65535&f))+a[d]+d,this.mt[c]>>>=0,c++,d++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1),d>=b&&(d=0)}for(e=this.N-1;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1566083941*((4294901760&f)>>>16)<<16)+1566083941*(65535&f))-c,this.mt[c]>>>=0,c++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1)}this.mt[0]=2147483648},c.prototype.genrand_int32=function(){var a,b=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var c;for(this.mti==this.N+1&&this.init_genrand(5489),c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[1&a];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[1&a];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[1&a],this.mti=0}return a=this.mt[this.mti++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},c.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},c.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},c.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},c.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},c.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(67108864*a+b)*(1/9007199254740992)},b.exports=c},{}],38:[function(a,b){"use strict";var c=a("./tile.js"),d=function(a){PIXI.SpriteBatch.call(this),this.game=a,this.entities=null,this.settings={},this.rooms=[],this.tiles=[],this.pixitiles=[],this.entrance=null,this.exit=null,this.allRooms=[],this.mediumRooms=[],this.hardRooms=[],this.roomsToExit=[],this.initialize()};d.prototype=Object.create(PIXI.SpriteBatch.prototype),d.prototype.constructor=d,d.prototype.initialize=function(){this.settings={tilesX:60,tilesY:40,tileSize:16,maxRooms:15,minRoomWidth:5,maxRoomWidth:8,minRoomHeight:5,maxRoomHeight:8,roomSpacing:1,maxMainRooms:10,maxMediumRooms:15,maxHardRooms:5};for(var a=0;a<this.settings.tilesX;a++){this.tiles[a]=[],this.pixitiles[a]=[];for(var b=0;b<this.settings.tilesY;b++)this.tiles[a][b]=new c(0,!0,0,0),this.pixitiles[a][b]=PIXI.Sprite.fromFrame("void.png"),this.pixitiles[a][b].position.x=a*this.settings.tileSize,this.pixitiles[a][b].position.y=b*this.settings.tileSize,this.addChild(this.pixitiles[a][b])}this.game.world.addChild(this)},d.prototype.getTileAt=function(a){var b=this.tiles[a.x][a.y];return b?b:new c},d.prototype.insideBounds=function(a){return a.x>0&&a.x<this.settings.tilesX&&a.y>0&&a.y<this.settings.tilesY},d.prototype.typeList=function(){for(var a=[],b=0;b<this.settings.tilesY;b++){a.push([]);for(var c=0;c<this.settings.tilesX;c++)a[b][c]=this.tiles[c][b].type}return a},d.prototype.roomFits=function(a){if(a.x1<1||a.x2>this.settings.tilesX-1||a.y1<1||a.y2>this.settings.tilesY-1)return!1;for(var b=0;b<this.allRooms.length;b++)if(a.x1<=this.allRooms[b].x2&&a.x2>=this.allRooms[b].x1&&a.y1<=this.allRooms[b].y2&&a.y2>=this.allRooms[b].y1)return!1;return!0},b.exports=d},{"./tile.js":42}],39:[function(a,b){"use strict";var c=a("../factories/propfactory.js"),d=a("../factories/decorationfactory.js"),e=a("../factories/enemyfactory.js"),f=a("../geometry/vector2.js"),g=a("../core/utils.js"),h=function(a){this.game=a,this.tileArray=[],this.initialize()};h.prototype={initialize:function(){this.tileArray.wall_single=[206],this.tileArray.wall_single_alone=[124,182,214,222,238,239,246,252,254,255],this.tileArray.wall_pillar_left=[125,204,212,253],this.tileArray.wall_corner_left=[76,92,148,156,220,221],this.tileArray.wall_top_end=[123,187,217,243,249,251],this.tileArray.wall_top_continue=[58,106,122,154,186,200,202,218,234,250],this.tileArray.wall_corner_left_down=[25,89,57,97,105,113,121],this.tileArray.wall_left_continue=[24,72,88],this.tileArray.wall_corner_right=[100,102,134,166,183,198,228,230,231,247],this.tileArray.wall_corner_both=[192],this.tileArray.pillar_right=[32],this.tileArray.pillar_left=[16],this.tileArray.pillar_both=[48],this.tileArray.wall=[17,33,49,68,85,101,117,132,149,161,165,181,196,213,229,245],this.tileArray.wall_corner_right_down=[35,51,145,147,163,177,179],this.tileArray.wall_right_continue=[34,162,130],this.tileArray.wall_continue_left_corner=[64,80],this.tileArray.wall_continue_right_corner=[128,160],this.tileArray.wall_corner_left_down_corner_right=[96],this.tileArray.wall_continue_left_corner_right_right=[152,216],this.tileArray.wall_corner_right_corner_left_up=[144],this.tileArray.wall_continue_left_corner_right=[104,120],this.tileArray.wall_continue_right_corner_left=[50,146,178],this.tileArray.wall_corner_right_corner_left=[98,194,226]},decorateMap:function(){this.placeEntrance(),this.placeExit(),this.setTileNumbers(),this.generateDoors(),this.populateDungeon()},setTileNumbers:function(){for(var a=this.game.map,b=0;b<a.settings.tilesX;b++)for(var c=0;c<a.settings.tilesY;c++){if(1===a.tiles[b][c].type){var e=this.game.map.tiles[b-1][c],h=this.game.map.tiles[b+1][c],i=this.game.map.tiles[b][c+1],j=this.game.map.tiles[b][c-1],k=this.game.map.tiles[b-1][c-1],l=this.game.map.tiles[b+1][c-1],m=this.game.map.tiles[b-1][c+1],n=this.game.map.tiles[b+1][c+1],o=0;2===j.type&&(o+=1),2===h.type&&(o+=2),2===i.type&&(o+=4),2===e.type&&(o+=8),2===k.type&&(o+=16),2===l.type&&(o+=32),2===m.type&&(o+=64),2===n.type&&(o+=128);for(var p in this.tileArray)if(-1!==this.tileArray[p].indexOf(o)){a.tiles[b][c].tileNumber=p,a.tiles[b][c].tileRow=g.randomNumber(0,1);var q=g.randomNumber(1,2),r=p+"_"+q+".png",s=PIXI.Texture.fromFrame(r);a.pixitiles[b][c].setTexture(s);break}}else if(2===a.tiles[b][c].type){var t=g.randomNumber(1,4),u="floor_"+t+".png",v=PIXI.Texture.fromFrame(u);this.game.map.pixitiles[b][c].setTexture(v)}if(2===a.tiles[b][c].type&&g.randomNumber(0,100)>=80){var w=new d.newGrass(this.game,new f(b,c));a.tiles[b][c].addEntity(w),a.entities.addEntity(w)}}},placeEntrance:function(){var a=this.game.map.roomsToExit[0].getRandomPosition(),b=c.newEntrance(this.game,a);this.game.map.entities.addEntity(b),this.game.map.entrance=a},placeExit:function(){var a=this.game.map.roomsToExit[this.game.map.roomsToExit.length-1].getRandomPosition(),b=c.newExit(this.game,a);this.game.map.entities.addEntity(b),this.game.map.exit=a},generateDoors:function(){for(var a=0;a<this.game.mapFactory.possibleDoorLocations.length;a++){var b=this.game.mapFactory.possibleDoorLocations[a],c=this.game.map.tiles[b.x-1][b.y],d=this.game.map.tiles[b.x+1][b.y],e=this.game.map.tiles[b.x][b.y-1],f=this.game.map.tiles[b.x][b.y+1],h=g.randomNumber(0,100);1===c.type&&1===d.type&&0===e.entities.length&&0===f.entities.length&&2===e.type&&2===f.type&&h>50?this.placeDoor(b,!1):2===c.type&&2===d.type&&0===c.entities.length&&0===d.entities.length&&1===e.type&&1===f.type&&h>50&&this.placeDoor(b,!0)}},placeDoor:function(a,b){var d=this.game.map.tiles[a.x][a.y],e=c.newDoor(this.game,a);if(b===!0){e.textureName="door_vertical_closed.png";var f=PIXI.Texture.fromFrame("door_vertical_closed.png");e.sprite.setTexture(f)}this.game.map.entities.addEntity(e),d.addEntity(e),d.blockLight=!0},populateDungeon:function(){for(var a=0;a<this.game.map.mediumRooms.length;a++)for(var b=this.game.map.mediumRooms[a],c=b.x1;c<b.x2;c++)for(var d=b.y1;d<b.y2;d++)if(2===this.game.map.tiles[c][d].type&&g.randomNumber(0,100)>=90){var h=new e.newSpider(this.game,new f(c,d));this.game.map.tiles[c][d].addEntity(h),this.game.map.entities.addEntity(h),this.game.scheduler.add(h,!0)}for(var i=0;i<this.game.map.hardRooms.length;i++)for(var j=this.game.map.hardRooms[i],k=j.x1;k<j.x2;k++)for(var l=j.y1;l<j.y2;l++)2===this.game.map.tiles[k][l].type&&g.randomNumber(0,100)>=90&&(h=new e.newSkeleton(this.game,new f(k,l)),this.game.map.tiles[k][l].addEntity(h),this.game.map.entities.addEntity(h),this.game.scheduler.add(h,!0))}},b.exports=h},{"../core/utils.js":3,"../factories/decorationfactory.js":5,"../factories/enemyfactory.js":6,"../factories/propfactory.js":8,"../geometry/vector2.js":31}],40:[function(a,b){"use strict";var c=a("./room.js"),d=a("../geometry/vector2.js"),e=(a("../factories/enemyfactory.js"),a("../core/utils.js")),f=function(a){this.game=a,this.map=a.map,this.possibleDoorLocations=[]};f.prototype={generateRooms:function(){this.generateFirstRoom(),this.generatePath("path",this.map.roomsToExit,this.map.settings.maxMainRooms),this.generatePath("random",this.map.mediumRooms,this.map.settings.maxMediumRooms),this.generatePath("randomMedium",this.map.hardRooms,this.map.settings.maxHardRooms)},generateFirstRoom:function(){var a=this.newRoom();a.initialize(),this.placeRoom(a),this.map.roomsToExit.push(a)},generatePath:function(a,b,c){for(var d=20,f=0;b.length<c&&!(f>=d);){var g,h,i=["left","right","up","down"];switch(a){case"path":h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}for(;;){if(0===i.length){if(f++,f>=d)break;switch(i=["left","right","up","down"],a){case"path":var j=this.map.roomsToExit.splice(this.map.roomsToExit.length-1,1)[0];this.map.mediumRooms.push(j),h=this.map.roomsToExit[this.map.roomsToExit.length-1];break;case"random":g=e.randomNumber(0,this.map.allRooms.length-1),h=this.map.allRooms[g];break;case"randomMedium":g=e.randomNumber(0,this.map.mediumRooms.length-1),h=this.map.mediumRooms[g]}}for(var k=e.randomNumber(0,i.length-1),l=i[k],m=5,n=0,o=this.generateRoomNextTo(h,l);!this.map.roomFits(o);){if(n>=m){i.splice(k,1);break}o=this.generateRoomNextTo(h,l),n++}if(this.map.roomFits(o)){o.initialize(),this.placeRoom(o),b.push(o),h.generateExit(),o.generateExit(),this.generateCorridor(h,o),i=["left","right","up","down"];break}}}},generateRoomNextTo:function(a,b){var c,d,f,g;switch(c=d=f=g=void 0,b){case"up":c=e.randomNumber(this.map.settings.minRoomHeight,this.map.settings.maxRoomHeight),f=a.x1+e.randomNumber(-2,3),g=a.y1-c-this.map.settings.roomSpacing;break;case"down":f=a.x1+e.randomNumber(-2,3),g=a.y2+this.map.settings.roomSpacing;break;case"left":d=e.randomNumber(this.map.settings.minRoomWidth,this.map.settings.maxRoomWidth),f=a.x1-d-this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3);break;case"right":f=a.x2+this.map.settings.roomSpacing,g=a.y1+e.randomNumber(-2,3)}return this.newRoom(d,c,f,g)},newRoom:function(a,b,d,f){var g="undefined"==typeof a?e.randomNumber(this.game.map.settings.minRoomWidth,this.game.map.settings.maxRoomWidth):a,h="undefined"==typeof b?e.randomNumber(this.game.map.settings.minRoomHeight,this.game.map.settings.maxRoomHeight):b,i="undefined"==typeof d?e.randomNumber(1,this.game.map.settings.tilesX-g-1):d,j="undefined"==typeof f?e.randomNumber(1,this.game.map.settings.tilesY-h-1):f;return new c(i,j,g,h)},placeRoom:function(a){this.game.map.allRooms.push(a);for(var b=a.x1;b<a.x2;b++)for(var c=a.x2-b-1,d=a.y1;d<a.y2;d++){var e=a.y2-d-1;2!==this.game.map.tiles[b][d].type&&(this.game.map.tiles[b][d]=a.layout[c][e])}},generateCorridor:function(a,b){var c={x:a.x1+a.exit.x,y:a.y1+a.exit.y},d={x:b.x1+b.exit.x,y:b.y1+b.exit.y};if(d.x!==c.x)if(d.x-c.x>0)for(var e=d.x;e>=c.x;e--)this.generateHorizontalCorridor(e,d.y);else for(var f=d.x;f<=c.x;f++)this.generateHorizontalCorridor(f,d.y);if(d.y!==c.y)if(d.y-c.y>0)for(var g=d.y;g>=c.y;g--)this.generateVerticalCorridor(c.x,g);else for(var h=d.y;h<=c.y;h++)this.generateVerticalCorridor(c.x,h)},generateHorizontalCorridor:function(a,b){var c=this.game.map,d=c.tiles[a][b],e=c.tiles[a][b+1],f=c.tiles[a][b-1];1===d.type&&1===e.type&&1===f.type&&this.possibleDoorLocations.push({x:a,y:b}),this.changeTileToFloor(d),0===e.type&&this.changeTileToWall(e),0===f.type&&this.changeTileToWall(f)},generateVerticalCorridor:function(a,b){var c=this.game.map,e=c.tiles[a][b],f=c.tiles[a+1][b],g=c.tiles[a-1][b];1===e.type&&1===f.type&&1===g.type&&this.possibleDoorLocations.push(new d(a,b)),this.changeTileToFloor(e),0===c.tiles[a+1][b+1].type&&this.changeTileToWall(c.tiles[a+1][b+1]),0===c.tiles[a-1][b-1].type&&this.changeTileToWall(c.tiles[a-1][b-1]),0===c.tiles[a+1][b-1].type&&this.changeTileToWall(c.tiles[a+1][b-1]),0===c.tiles[a-1][b+1].type&&this.changeTileToWall(c.tiles[a-1][b+1])},changeTileToFloor:function(a){a.type=2,a.tileRow=3,a.tileNumber=e.randomNumber(2,5),a.blockLight=!1},changeTileToWall:function(a){a.type=1,a.tileRow=0,a.tileNumber=10,a.blockLight=!0}},b.exports=f},{"../core/utils.js":3,"../factories/enemyfactory.js":6,"../geometry/vector2.js":31,"./room.js":41}],41:[function(a,b){"use strict";var c=a("./tile.js"),d=a("../geometry/vector2.js"),e=a("../core/utils.js"),f=function(a,b,c,d){this.x1=a,this.x2=c+a,this.y1=b,this.y2=b+d,this.w=c,this.h=d,this.layout=[],this.exit=null};f.prototype={initialize:function(){for(var a=0;a<this.w;a++){this.layout[a]=[];for(var b=0;b<this.h;b++)this.layout[a][b]=0===b||b===this.h-1||0===a||a===this.w-1?new c(1,!0,this,0,10):new c(2,!1,this,3,e.randomNumber(2,5))}},generateExit:function(){switch(e.randomNumber(1,4)){case 1:this.exit={x:e.randomNumber(1,this.w-2),y:this.h-2};break;case 2:this.exit={x:e.randomNumber(1,this.w-2),y:1};break;case 3:this.exit={x:this.w-2,y:e.randomNumber(1,this.h-2)};break;case 4:this.exit={x:1,y:e.randomNumber(1,this.h-2)}}},getRandomPosition:function(){var a=e.randomNumber(2,this.w-3),b=e.randomNumber(2,this.h-3);return a+=this.x1,b+=this.y1,new d(a,b)}},b.exports=f},{"../core/utils.js":3,"../geometry/vector2.js":31,"./tile.js":42}],42:[function(a,b){"use strict";var c=function(a,b,c){this.type=a,this.blockLight=b,this.belongsTo=c||null,this.entities=[],this.lightLevel=0,this.renderLightLevel=0,this.explored=!1};c.prototype={addEntity:function(a){this.entities.push(a)},removeEntity:function(a){var b=this.entities.indexOf(a);return-1===b?!1:(this.entities.splice(b,1),!0)}},b.exports=c},{}],43:[function(a,b){"use strict";var c=function(){this.time=0,this.events=[],this.eventTimes=[]};c.prototype={getTime:function(){return this.time},clear:function(){this.events=[],this.eventTimes=[]},add:function(a,b){for(var c=this.events.length,d=0;d<this.eventTimes.length;d++)if(this.eventTimes[d]>b){c=d;break}this.events.splice(c,0,a),this.eventTimes.splice(c,0,b)},get:function(){if(0===this.events.length)return null;var a=this.eventTimes.splice(0,1)[0];if(a>0){this.time+=a;for(var b=0;b<this.eventTimes.length;b++)this.eventTimes[b]-=a}return this.events.splice(0,1)[0]},remove:function(a){var b=this.events.indexOf(a);return-1===b?!1:(this.events.splice(b,1),this.eventTimes.splice(b,1),!0)}},b.exports=c},{}],44:[function(a,b){"use strict";var c=a("./queue.js"),d=function(){this.queue=null,this.repeat=[],this.current=null,this.lockCount=0,this.initialize()};d.prototype={initialize:function(){this.queue=new c},getTime:function(){return this.queue.getTime()},add:function(a,b){return this.queue.add(a,1/a.getSpeed()),b&&this.repeat.push(a),this},remove:function(a){var b=this.queue.remove(a),c=this.repeat.indexOf(a);return-1!==c&&this.repeat.splice(c,1),this.current===a&&(this.current=null),b},clear:function(){return this.queue.clear(),this.repeat=[],this.current=null,this},next:function(){return this.current&&-1!==this.repeat.indexOf(this.current)&&this.queue.add(this.current,1/this.current.getSpeed()),this.current=this.queue.get(),this.current},tick:function(){if(this.lockCount>0)return!1;var a=this.next();return null===a?!1:(a.act(),!0)},lock:function(){this.lockCount++},unlock:function(){0!==this.lockCount&&this.lockCount--}},b.exports=d},{"./queue.js":43}],45:[function(a,b){"use strict";var c=a("../geometry/vector2.js"),d=function(a){PIXI.DisplayObjectContainer.call(this),this.game=a,this.maxQuickslots=9};d.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),d.prototype.constructor=d,d.prototype.initialize=function(){for(var a=new c(this.game.width/2-44*this.maxQuickslots-21,this.game.height-57),b=0;b<this.maxQuickslots;b++){var d=new c(44*b,0),e=d.combine(a),f=PIXI.Texture.fromFrame("itemslot.png"),g=new PIXI.Sprite(f);g.position.x=e.x,g.position.y=e.y,g.scale=new PIXI.Point(3,3),this.addChild(g);var h=new PIXI.Text(""+(b+1),{font:"10px Courier New",fill:"#606060",align:"left"}),i=e.combine(new c(30,30));h.position.x=i.x,h.position.y=i.y}},b.exports=d},{"../geometry/vector2.js":31}],46:[function(a,b){"use strict";var c=a("../geometry/vector2.js"),d=function(a){PIXI.DisplayObjectContainer.call(this),this.game=a,this.maxSpellslots=9};d.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),d.prototype.constructor=d,d.prototype.initialize=function(){for(var a=new c(this.game.width/2+21,this.game.height-57),b=0;b<this.maxSpellslots;b++){var d=new c(44*b,0),e=d.combine(a),f=PIXI.Texture.fromFrame("itemslot.png"),g=new PIXI.Sprite(f);g.position.x=e.x,g.position.y=e.y,g.scale=new PIXI.Point(3,3),this.addChild(g);var h=new PIXI.Text(""+(b+1),{font:"10px Courier New",fill:"#606060",align:"left"}),i=e.combine(new c(30,30));h.position.x=i.x,h.position.y=i.y}},b.exports=d},{"../geometry/vector2.js":31}],47:[function(a,b){"use strict";var c=function(){PIXI.DisplayObjectContainer.call(this),this.color="rgba(255, 255, 255, 1)",this.fontSize=12,this.margin=5,this.font="Courier New",this.maxMessages=5,this.messages=[]};c.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),c.prototype.constructor=c,c.prototype.initialize=function(){for(var a=0;a<this.maxMessages;a++){var b=new PIXI.Text("",{font:this.fontSize+"px "+this.font,fill:this.color,align:"left"});b.position.x=15,b.position.y=15+(b.height+this.margin)*a,this.addChild(b)}},c.prototype.updateText=function(){for(var a=this.getMessages(),b=0;b<this.maxMessages&&a[a.length-1-b];b++)this.getChildAt(b).setText(a[a.length-1-b])},c.prototype.addMessage=function(a){this.messages.push(a),this.updateText()},c.prototype.getMessages=function(){return this.messages},c.prototype.clear=function(){this.messages=[];for(var a=0;a<this.maxMessages;a++)this.getChildAt(a).setText("")},b.exports=c},{}],48:[function(a,b){"use strict";var c=function(){PIXI.DisplayObjectContainer.call(this),this.background=null,this.title=null,this.type=null,this.description=null};c.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),c.prototype.constructor=c,c.prototype.initialize=function(){this.background=new PIXI.Graphics,this.addChild(this.background),this.title=new PIXI.Text("",{font:"bold 12px Courier New",fill:"#ffffff",wordWrap:!0,wordWrapWidth:150}),this.title.position.x=15,this.addChild(this.title),this.type=new PIXI.Text("",{font:"12px Courier New",fill:"#ffffff",wordWrap:!0,wordWrapWidth:150}),this.type.position.x=15,this.addChild(this.type),this.description=new PIXI.Text("",{font:"12px Courier New",fill:"#b4b4b4",wordWrap:!0,wordWrapWidth:150}),this.description.position.x=15,this.addChild(this.description)},c.prototype.updateText=function(a,b,c){this.title.setText(a),this.type.setText(b),this.description.setText(c);var d=15;this.title.position.y=d,""!==a&&(d+=this.title.height),this.type.position.y=d,""!==b&&(d+=this.type.height),this.description.position.y=d,""!==c&&(d+=this.description.height),d+=15,this.background.clear(),this.background.beginFill(0,.5),this.background.drawRect(0,0,this.width+30,d)},b.exports=c},{}],49:[function(a,b){"use strict";var c=a("../ui/textlog.js"),d=a("../ui/quickslotbar.js"),e=a("../ui/spellbar.js"),f=a("../ui/tooltipelement.js"),g=a("../geometry/vector2.js"),h=function(a){PIXI.DisplayObjectContainer.call(this),this.game=a,this.stats=null,this.textLog=null,this.quickslotBar=null,this.spellbar=null,this.mousePointer=null,this.tooltip=null,this.initialize()};h.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),h.prototype.constructor=h,h.prototype.initialize=function(){this.initializeStats(),this.initializeTextLog(),this.initializeBars(),this.initializeMousePointer(),this.initializeTooltip(),this.game.stage.mousemove=this.mouseMove.bind(this),this.game.stage.addChild(this)},h.prototype.initializeStats=function(){this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.right="10px",this.stats.domElement.style.top="10px",document.body.appendChild(this.stats.domElement)},h.prototype.initializeTextLog=function(){this.textLog=new c,this.textLog.initialize();var a="You enter the basement and look around";this.textLog.addMessage(a),this.addChild(this.textLog)},h.prototype.initializeBars=function(){this.quickslotBar=new d(this.game),this.quickslotBar.initialize(),this.addChild(this.quickslotBar),this.spellBar=new e(this.game),this.spellBar.initialize(),this.addChild(this.spellBar)},h.prototype.initializeMousePointer=function(){this.mousePointer=PIXI.Sprite.fromFrame("mousepointer.png"),this.mousePointer.scale=new PIXI.Point(3,3),this.addChild(this.mousePointer)},h.prototype.initializeTooltip=function(){this.tooltip=new f,this.tooltip.initialize(),this.addChild(this.tooltip)},h.prototype.mouseMove=function(a){var b=this.game.map,c=this.game.world.camera,d=b.settings.tileSize*this.game.settings.zoom,e=c.position.x%d,f=c.position.y%d,h=Math.floor((a.global.x+e)/d),i=Math.floor((a.global.y+f)/d),j=Math.floor((a.global.x+c.position.x)/d),k=Math.floor((a.global.y+c.position.y)/d),l=new g(j,k);if(!b.insideBounds(l))return void(this.tooltip.visible=this.mousePointer.visible=!1);var m=b.getTileAt(l);if(2!==m.type||!m.explored)return void(this.tooltip.visible=this.mousePointer.visible=!1);if(this.mousePointer.visible=!0,this.mousePointer.position=new PIXI.Point(h*d-e,i*d-f),0===m.entities.length)return void(this.tooltip.visible=!1);var n=m.entities[m.entities.length-1];if(n.hasComponent("tooltip")){var o=n.getComponent("tooltip");this.tooltip.updateText(o.title,o.type,o.description),this.tooltip.position=new PIXI.Point(a.global.x,a.global.y),this.tooltip.visible=!0}else this.tooltip.visible=!1},b.exports=h},{"../geometry/vector2.js":31,"../ui/quickslotbar.js":45,"../ui/spellbar.js":46,"../ui/textlog.js":47,"../ui/tooltipelement.js":48}]},{},[32]);